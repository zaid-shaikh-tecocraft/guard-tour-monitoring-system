<%- include('../partials/header') %>
<div class="card">
    <div class="card-header">
        <h2><%= assignment ? 'Edit' : 'New' %> Patrol Assignment</h2>
        <a href="/patrol-assignments" class="btn btn-secondary">Back</a>
    </div>
    <% if (typeof error !== 'undefined' && error) { -%>
    <div class="error"><%= error %></div>
    <% } -%>
    <form method="POST" action="<%= assignment ? '/patrol-assignments/' + assignment.id : '/patrol-assignments' %>">
        <div class="form-group">
            <label for="orgId">Organization *</label>
            <select id="orgId" name="orgId" required>
                <option value="">Select Organization</option>
                <% organizations.forEach(org => { -%>
                <option value="<%= org.id %>" <%= assignment && assignment.orgId === org.id ? 'selected' : '' %>><%= org.name %></option>
                <% }); -%>
            </select>
        </div>
        <div class="form-group">
            <label for="guardId">Guard *</label>
            <select id="guardId" name="guardId" required>
                <option value="">Select Guard</option>
                <% guards.forEach(guard => { -%>
                <option value="<%= guard.id %>" <%= assignment && assignment.guardId === guard.id ? 'selected' : '' %>><%= guard.name %> (<%= guard.rfid %>)</option>
                <% }); -%>
            </select>
        </div>
        <div class="form-group">
            <label for="patrolPointId">Patrol Point *</label>
            <select id="patrolPointId" name="patrolPointId" required>
                <option value="">Select Patrol Point</option>
                <% patrolPoints.forEach(point => { -%>
                <option value="<%= point.id %>" <%= assignment && assignment.patrolPointId === point.id ? 'selected' : '' %>><%= point.name %> (<%= point.rfid %>)</option>
                <% }); -%>
            </select>
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" name="isActive" <%= assignment && assignment.isActive ? 'checked' : '' %>>
                Active
            </label>
        </div>
        <div class="form-group">
            <label for="startDate">Start Date</label>
            <input type="datetime-local" id="startDate" name="startDate" value="<%= assignment && assignment.startDate ? new Date(assignment.startDate).toISOString().slice(0, 16) : '' %>">
        </div>
        <div class="form-group">
            <label for="endDate">End Date</label>
            <input type="datetime-local" id="endDate" name="endDate" value="<%= assignment && assignment.endDate ? new Date(assignment.endDate).toISOString().slice(0, 16) : '' %>">
        </div>
        <div class="actions">
            <button type="submit" class="btn btn-success"><%= assignment ? 'Update' : 'Create' %> Assignment</button>
            <a href="/patrol-assignments" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>
<%- include('../partials/footer') %>
